<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Epic Piping: Leave Management Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #0b0f1a; color: #e2e8f0; font-family: 'Inter', sans-serif; }
        .gantt-container { display: grid; grid-template-columns: 320px 1fr; }
        .week-segment { flex: 1; border-right: 1px solid #1e293b; font-size: 8px; text-align: center; padding-top: 4px; color: #475569; }
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
        .leave-bar:hover .tooltip { display: block; }
        .admin-only { display: none; }
        body.admin-mode .admin-only { display: block; }
        .status-low { color: #f87171; } /* Red for low availability */
        .status-ok { color: #34d399; }  /* Green for good availability */
    </style>
</head>
<body class="p-4 md:p-6">

    <div class="max-w-[1650px] mx-auto">
        <header class="flex flex-col xl:flex-row justify-between items-start xl:items-center mb-6 gap-4">
            <div>
                <h1 class="text-2xl font-bold text-emerald-400 tracking-tight underline decoration-emerald-800">LEAVE RESOURCE PLANNER 2026</h1>
                <p class="text-slate-500 text-sm">Conflict Engine + Team Availability + Management Tools</p>
            </div>

            <div class="flex flex-wrap gap-3 bg-slate-900/80 p-3 rounded-xl border border-slate-800 shadow-xl">
                <input type="text" id="nameSearch" placeholder="Search name..." oninput="render()" 
                       class="bg-slate-800 border border-slate-700 rounded px-3 py-1.5 text-sm outline-none focus:border-emerald-500 w-40">
                
                <select id="teamFilter" onchange="render()" class="bg-slate-800 border border-slate-700 rounded px-3 py-1.5 text-sm outline-none cursor-pointer">
                    <option value="All">All Teams</option>
                    <option value="Team B">Team B</option>
                    <option value="Team C">Team C</option>
                    <option value="Support Team">Support Team</option>
                    <option value="DC Team">DC Team</option>
                    <option value="Material Team">Material Team</option>
                </select>

                <button onclick="toggleAdmin()" id="adminBtn" class="bg-emerald-600 hover:bg-emerald-500 text-white px-4 py-1.5 rounded text-sm font-bold transition-all shadow-lg">
                    Admin Login
                </button>
            </div>
        </header>

        <div class="admin-only mb-6 bg-slate-900 border-2 border-emerald-500/30 p-5 rounded-2xl shadow-2xl relative">
            <h3 id="formTitle" class="text-emerald-400 font-bold text-xs mb-4 uppercase tracking-widest">Add New Leave Entry</h3>
            <input type="hidden" id="editIndex" value="-1">
            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-7 gap-4">
                <div class="flex flex-col gap-1">
                    <label class="text-[10px] text-slate-500 font-bold">NAME</label>
                    <input type="text" id="newName" class="bg-slate-800 border border-slate-700 p-2 rounded text-sm outline-none focus:border-emerald-500">
                </div>
                <div class="flex flex-col gap-1">
                    <label class="text-[10px] text-slate-500 font-bold">DESIGNATION</label>
                    <input type="text" id="newRole" class="bg-slate-800 border border-slate-700 p-2 rounded text-sm outline-none focus:border-emerald-500">
                </div>
                <div class="flex flex-col gap-1">
                    <label class="text-[10px] text-slate-500 font-bold">TEAM</label>
                    <select id="newTeam" class="bg-slate-800 border border-slate-700 p-2 rounded text-sm outline-none">
                        <option>Team B</option><option>Team C</option><option>Support Team</option><option>DC Team</option><option>Material Team</option>
                    </select>
                </div>
                <div class="flex flex-col gap-1">
                    <label class="text-[10px] text-slate-500 font-bold">START DATE</label>
                    <input type="date" id="newStart" class="bg-slate-800 border border-slate-700 p-2 rounded text-sm outline-none">
                </div>
                <div class="flex flex-col gap-1">
                    <label class="text-[10px] text-slate-500 font-bold">END DATE</label>
                    <input type="date" id="newEnd" class="bg-slate-800 border border-slate-700 p-2 rounded text-sm outline-none">
                </div>
                <div class="flex flex-col gap-1">
                    <label class="text-[10px] text-slate-500 font-bold">ACTION</label>
                    <button id="saveBtn" onclick="saveEntry()" class="bg-emerald-500 text-slate-900 font-black h-full rounded hover:bg-emerald-400 transition-colors py-2">SAVE ENTRY</button>
                </div>
                <div class="flex flex-col gap-1">
                    <label class="text-[10px] text-slate-500 font-bold">SYSTEM</label>
                    <button onclick="resetData()" class="bg-red-900/50 text-red-400 font-bold h-full rounded hover:bg-red-800 transition-colors py-2 border border-red-800/50">WIPE ALL</button>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
            
            <div class="lg:col-span-1 space-y-6">
                <div class="bg-slate-900 border border-slate-800 p-4 rounded-xl">
                    <h2 class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-4">Team Availability %</h2>
                    <div id="availabilityStats" class="space-y-3 max-h-80 overflow-y-auto pr-2">
                        </div>
                </div>

                <div id="conflictPanel" class="hidden bg-red-950/20 border border-red-900/40 rounded-xl p-4 shadow-inner">
                    <h2 class="text-red-500 font-bold text-xs uppercase tracking-widest mb-3">⚠️ Critical Collapses</h2>
                    <div id="conflictList" class="space-y-2"></div>
                </div>
            </div>

            <div class="lg:col-span-3 bg-slate-900 border border-slate-800 rounded-xl overflow-hidden shadow-2xl">
                <div class="gantt-container bg-slate-800/40 border-b border-slate-700">
                    <div class="p-4 font-bold text-slate-400 border-r border-slate-700 uppercase text-[10px] tracking-widest flex items-end">Organization View</div>
                    <div class="flex flex-col">
                        <div class="flex border-b border-slate-700/50">
                            <script>
                                ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"].forEach(m => 
                                    document.write(`<div class="flex-1 text-center py-2 text-[10px] font-bold uppercase border-r border-slate-700/50 text-slate-400">${m}</div>`));
                            </script>
                        </div>
                        <div class="flex">
                            <script>
                                for(let i=0; i<12; i++) {
                                    document.write('<div class="flex-1 flex border-r border-slate-700/30">');
                                    for(let j=1; j<=4; j++) document.write(`<div class="week-segment">W${j}</div>`);
                                    document.write('</div>');
                                }
                            </script>
                        </div>
                    </div>
                </div>
                <div id="chartBody" class="max-h-[60vh] overflow-y-auto"></div>
            </div>
        </div>
    </div>

    <script>
        const PASS = "leave";
        const DEFAULT_DATA = [
            { name: "Saurav cs", team: "Team C", role: "Piping Checker", start: "2026-04-15", end: "2026-05-15", remark: "MARRAIGE" },
            { name: "Vivek Krishnan", team: "Team B", role: "Piping Checker", start: "2026-05-24", end: "2026-06-24", remark: "" },
            { name: "Harikrishnan TS", team: "Team B", role: "Piping Checker", start: "2026-08-10", end: "2026-09-10", remark: "" },
            { name: "Mojahid Raja", team: "Team B", role: "Piping Checker", start: "2026-03-23", end: "2026-04-19", remark: "ANNUAL LEAVE" },
            { name: "Shibnath Ghanta", team: "Team B", role: "Team Leader", start: "2026-03-23", end: "2026-04-21", remark: "Anual Leave" },
            { name: "Prosenjit Ghosh", team: "Team B", role: "Piping Checker", start: "2026-10-11", end: "2026-11-20", remark: "" },
            { name: "Rutika Pat", team: "Team B", role: "Piping Detailer", start: "2026-08-16", end: "2026-09-14", remark: "" },
            { name: "Monisha Unnithan", team: "Team C", role: "Piping Checker", start: "2026-09-15", end: "2026-10-14", remark: "" },
            { name: "Sreesh Sureshkumar", team: "Team B", role: "Piping Checker", start: "2026-03-26", end: "2026-05-04", remark: "WEDDING" },
            { name: "Ritesh Kumar", team: "Team B", role: "Piping Checker", start: "2026-04-05", end: "2026-05-01", remark: "" },
            { name: "Sreejin Ms", team: "Team B", role: "Piping Detailer", start: "2026-04-10", end: "2026-05-10", remark: "" },
            { name: "Nikhil Sankar", team: "Team B", role: "Piping Detailer", start: "2026-11-01", end: "2026-12-06", remark: "" },
            { name: "Chetan Yerne", team: "Team C", role: "Team Leader", start: "2026-11-15", end: "2026-12-14", remark: "" },
            { name: "Athul Vincent", team: "Support Team", role: "Support Checker", start: "2026-10-01", end: "2026-10-28", remark: "" },
            { name: "Prakyath Prakash Kumar", team: "DC Team", role: "Document Controller", start: "2026-09-01", end: "2026-10-01", remark: "" },
            { name: "Melisha Dsouza", team: "DC Team", role: "Document Controller", start: "2026-05-03", end: "2026-05-29", remark: "" },
            { name: "Zaheer Ahmed", team: "Team C", role: "Piping Checker", start: "2026-05-07", end: "2026-06-05", remark: "Marriage" },
            { name: "Sruthy Raj", team: "DC Team", role: "Document Controller", start: "2026-11-01", end: "2026-11-30", remark: "" },
            { name: "Suman Mondal", team: "Revision Team", role: "Piping Checker", start: "2026-02-01", end: "2026-03-02", remark: "" },
            { name: "Nishanth IV", team: "Team B", role: "Piping Checker", start: "2026-04-22", end: "2026-05-29", remark: "" },
            { name: "Mohammad Navaz", team: "Team C", role: "Piping Detailer", start: "2026-07-26", end: "2026-08-28", remark: "" },
            { name: "Sabeel Manaf", team: "Team C", role: "Piping Checker", start: "2026-10-04", end: "2026-11-03", remark: "" },
            { name: "Owaish Shamsi", team: "Team B", role: "Piping Checker", start: "2026-10-05", end: "2026-11-05", remark: "" },
            { name: "Rajnish Choubey", team: "Team C", role: "Piping Checker", start: "2026-10-16", end: "2026-11-18", remark: "" },
            { name: "Mohammed Sadhik", team: "Team C", role: "Piping Checker", start: "2026-10-04", end: "2026-11-02", remark: "" },
            { name: "Sayan Mishra", team: "Team C", role: "Piping Detailer", start: "2026-11-01", end: "2026-11-29", remark: "" },
            { name: "Maqbool Ahmad", team: "Team C", role: "Piping Detailer", start: "2026-10-04", end: "2026-10-30", remark: "" },
            { name: "Mohammad Waquar", team: "Team B", role: "Piping Checker", start: "2026-10-15", end: "2026-11-15", remark: "" },
            { name: "Salim Malick", team: "Team C", role: "Piping Detailer", start: "2026-04-12", end: "2026-05-25", remark: "Marriage" },
            { name: "Jayesh Saroj", team: "Support Team", role: "Team Leader", start: "2026-02-09", end: "2026-03-10", remark: "" },
            { name: "Arunkumar Nedunchezhian", team: "Team C", role: "Piping Detailer", start: "2026-07-13", end: "2026-08-13", remark: "" },
            { name: "Krishnakumar Pandiyan", team: "Team C", role: "Piping Detailer", start: "2026-07-12", end: "2026-08-10", remark: "" },
            { name: "Vishnu TRK", team: "Team C", role: "Piping Checker", start: "2026-10-01", end: "2026-10-31", remark: "" },
            { name: "Lekshmi Seema", team: "Support Team", role: "Support Checker", start: "2026-12-20", end: "2027-01-20", remark: "" },
            { name: "Ismail Ebrahim", team: "CAD Admin Team", role: "AutoSpool Admin", start: "2026-03-15", end: "2026-04-13", remark: "" },
            { name: "Anwin John", team: "CAD Admin Team", role: "AutoSpool Admin", start: "2026-12-20", end: "2027-01-19", remark: "" },
            { name: "Kim Rose", team: "Material Team", role: "Material Analyst", start: "2026-11-22", end: "2026-12-22", remark: "" },
            { name: "Abhinand Nair", team: "Team B", role: "Piping Checker", start: "2026-07-05", end: "2026-08-05", remark: "Marriage" },
            { name: "Pradheesh Manikandan", team: "Team B", role: "Piping Detailer", start: "2026-06-08", end: "2026-07-09", remark: "" },
            { name: "Sruthy K", team: "Material Team", role: "Material Analyst", start: "2026-11-25", end: "2026-12-25", remark: "" },
            { name: "Yamin Pa Pa Soe", team: "Material Team", role: "Material Analyst", start: "2026-12-01", end: "2026-12-31", remark: "" },
            { name: "Nivin Varkey", team: "Material Team", role: "Project Engineer", start: "2026-02-02", end: "2026-02-07", remark: "" },
            { name: "Ashith Pakkan", team: "Support Team", role: "Support Detailer", start: "2026-12-06", end: "2027-01-08", remark: "" },
            { name: "Hnin Thazin", team: "Support Team", role: "Support Detailer", start: "2026-10-11", end: "2026-11-10", remark: "" },
            { name: "Sangeetha C", team: "Team C", role: "Piping Detailer", start: "2026-04-26", end: "2026-05-22", remark: "" },
            { name: "Shelma Antony", team: "Team C", role: "Piping Checker", start: "2026-08-09", end: "2026-09-05", remark: "" },
            { name: "Ragul Raja", team: "Team C", role: "Piping Checker", start: "2026-12-28", end: "2027-01-27", remark: "" },
            { name: "Amal Kumar", team: "Revision Team", role: "Piping Detailer", start: "2026-06-21", end: "2026-07-20", remark: "" }
        ];

        let leaveData = JSON.parse(localStorage.getItem('epicLeaveDB')) || DEFAULT_DATA;

        function toggleAdmin() {
            if (document.body.classList.contains('admin-mode')) {
                document.body.classList.remove('admin-mode');
                document.getElementById('adminBtn').innerText = "Admin Login";
            } else {
                if (prompt("Enter Password:") === PASS) {
                    document.body.classList.add('admin-mode');
                    document.getElementById('adminBtn').innerText = "Logout Admin";
                }
            }
            render();
        }

        function saveEntry() {
            const idx = parseInt(document.getElementById('editIndex').value);
            const entry = {
                name: document.getElementById('newName').value,
                role: document.getElementById('newRole').value,
                team: document.getElementById('newTeam').value,
                start: document.getElementById('newStart').value,
                end: document.getElementById('newEnd').value,
                remark: "PLANNED"
            };

            if (!entry.name || !entry.start || !entry.end) return alert("Missing fields");
            if (new Date(entry.start) > new Date(entry.end)) return alert("Start date cannot be after end date");

            if (idx === -1) leaveData.push(entry);
            else leaveData[idx] = entry;

            // Reset form
            document.getElementById('editIndex').value = "-1";
            document.getElementById('formTitle').innerText = "Add New Leave Entry";
            document.getElementById('saveBtn').innerText = "SAVE ENTRY";
            document.getElementById('newName').value = '';
            
            saveAndRender();
        }

        function editEntry(index) {
            const emp = leaveData[index];
            document.getElementById('newName').value = emp.name;
            document.getElementById('newRole').value = emp.role;
            document.getElementById('newTeam').value = emp.team;
            document.getElementById('newStart').value = emp.start;
            document.getElementById('newEnd').value = emp.end;
            document.getElementById('editIndex').value = index;
            document.getElementById('formTitle').innerText = "Editing: " + emp.name;
            document.getElementById('saveBtn').innerText = "UPDATE ENTRY";
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function removeEntry(index) {
            if (confirm(`Delete ${leaveData[index].name}'s record?`)) {
                leaveData.splice(index, 1);
                saveAndRender();
            }
        }

        function resetData() {
            if (confirm("This will delete all custom changes. Revert to original?")) {
                leaveData = [...DEFAULT_DATA];
                saveAndRender();
            }
        }

        function saveAndRender() {
            localStorage.setItem('epicLeaveDB', JSON.stringify(leaveData));
            render();
        }

        function getOverlaps(current, all) {
            return all.filter(other => {
                if (current === other) return false;
                if (current.team !== other.team || current.role !== other.role) return false;
                return new Date(current.start) <= new Date(other.end) && new Date(other.start) <= new Date(current.end);
            });
        }

        function calculateAvailability() {
            const teams = [...new Set(leaveData.map(e => e.team))];
            const stats = document.getElementById('availabilityStats');
            stats.innerHTML = '';

            teams.forEach(team => {
                const teamMembers = leaveData.filter(e => e.team === team).length + 5; // Simulating base staff count
                const monthLeaves = Array(12).fill(0);

                leaveData.filter(e => e.team === team).forEach(emp => {
                    const start = new Date(emp.start).getMonth();
                    const end = new Date(emp.end).getMonth();
                    for(let i=start; i<=end; i++) monthLeaves[i]++;
                });

                let teamHtml = `<div class="mb-4"><h4 class="text-[11px] font-black text-emerald-500">${team}</h4><div class="flex gap-1 mt-1">`;
                monthLeaves.forEach((leaves, i) => {
                    const avail = Math.max(0, 100 - (leaves * 20)); // Arbitrary logic for visualization
                    teamHtml += `<div class="flex-1 h-8 flex flex-col items-center justify-center rounded bg-slate-800 border border-slate-700">
                        <span class="text-[7px] text-slate-500">${months[i][0]}</span>
                        <span class="text-[9px] font-bold ${avail < 70 ? 'text-red-500' : 'text-emerald-400'}">${avail}%</span>
                    </div>`;
                });
                teamHtml += `</div></div>`;
                stats.innerHTML += teamHtml;
            });
        }

        function render() {
            const teamFilter = document.getElementById('teamFilter').value;
            const search = document.getElementById('nameSearch').value.toLowerCase();
            const body = document.getElementById('chartBody');
            const confPanel = document.getElementById('conflictPanel');
            const confList = document.getElementById('conflictList');
            
            body.innerHTML = ''; confList.innerHTML = '';
            let hasConflicts = false;

            leaveData.forEach((emp, index) => {
                const conflicts = getOverlaps(emp, leaveData);
                const isConflicted = conflicts.length > 0;

                if (isConflicted) {
                    hasConflicts = true;
                    if (!confList.innerHTML.includes(emp.name)) {
                        confList.innerHTML += `<div class="bg-red-950/40 p-2 rounded text-[10px] border border-red-800 flex justify-between">
                            <span><strong>${emp.name}</strong> clashes with ${conflicts[0].name}</span>
                        </div>`;
                    }
                }

                if ((teamFilter === 'All' || emp.team === teamFilter) && emp.name.toLowerCase().includes(search)) {
                    const start = new Date(emp.start);
                    const end = new Date(emp.end);
                    const left = ((start - new Date('2026-01-01')) / (1000*60*60*24) / 365) * 100;
                    const width = ((end - start) / (1000*60*60*24) / 365) * 100;

                    const row = document.createElement('div');
                    row.className = 'gantt-container border-b border-slate-800/40 items-center transition-colors hover:bg-slate-800/20';
                    row.innerHTML = `
                        <div class="p-3 border-r border-slate-800 flex justify-between items-center group">
                            <div>
                                <div class="text-[11px] font-bold ${isConflicted ? 'text-red-500' : 'text-slate-200'}">${emp.name}</div>
                                <div class="text-[8px] text-slate-500 uppercase font-black">${emp.role}</div>
                            </div>
                            <div class="admin-only flex gap-2">
                                <button onclick="editEntry(${index})" class="text-blue-400 hover:text-white transition-colors">✏️</button>
                                <button onclick="removeEntry(${index})" class="text-red-500 hover:text-white transition-colors">✕</button>
                            </div>
                        </div>
                        <div class="relative h-12 w-full flex items-center px-1">
                            <div class="absolute inset-0 flex pointer-events-none opacity-5">
                                ${Array(12).fill(0).map(() => `<div class="flex-1 border-r border-slate-400"></div>`).join('')}
                            </div>
                            <div class="leave-bar absolute h-7 rounded-md border border-white/10 shadow-lg flex items-center px-3 group cursor-help transition-all hover:scale-[1.01]"
                                 style="left: ${left}%; width: ${width}%; background: ${isConflicted ? 'linear-gradient(to right, #7f1d1d, #ef4444)' : 'linear-gradient(to right, #064e3b, #10b981)'}">
                                <span class="text-[8px] font-black text-white truncate uppercase">${isConflicted ? '⚠️ CONFLICT' : (emp.remark || 'VACATION')}</span>
                                <div class="tooltip hidden absolute bottom-full left-1/2 -translate-x-1/2 mb-2 bg-white text-slate-900 text-[10px] font-bold p-2 rounded shadow-2xl z-50 whitespace-nowrap">
                                    ${emp.name} (${emp.team})<br/>
                                    ${emp.start} TO ${emp.end}
                                </div>
                            </div>
                        </div>
                    `;
                    body.appendChild(row);
                }
            });
            confPanel.style.display = hasConflicts ? 'block' : 'none';
            calculateAvailability();
        }

        const months = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
        render();
    </script>
</body>
</html>
